<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Portail Partenaires - Centum T&S</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f7fa; min-height: 100vh; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState } = React;
        
        // Configuration visibilit√© (modifiable par admin)
        const defaultVisibilityConfig = {
            afficherTJM: true,
            afficherRemises: true,
            afficherBudget: true,
            afficherTauxOccupation: true,
            afficherGrilleTarifaire: true,
            moisVisibles: 11, // 1-11 mois (f√©v-d√©c)
        };
        
        // Labels FOMO
        const fomoOptions = [
            { value: 'aucun', label: 'Aucun badge', color: null },
            { value: 'forte-demande', label: 'üî• Forte demande', color: '#dc2626' },
            { value: 'propose-ailleurs', label: 'üëÄ D√©j√† propos√© ailleurs', color: '#f59e0b' },
            { value: 'dernieres-dispos', label: '‚è∞ Derni√®res dispos', color: '#8b5cf6' },
            { value: 'mission-a-venir', label: 'üìÖ Mission √† venir', color: '#0ea5e9' },
        ];
        
        // Donn√©es avec p√©riodes r√©alistes f√©vrier-d√©cembre 2026
        // Cong√©s typiques France : vacances de f√©vrier (zone), P√¢ques (avril), ponts de mai, √©t√© (juillet-ao√ªt), Toussaint, No√´l
        const consultantsData = [
            { 
                id: 1, code: "FLEGA", 
                competences: ["Archi. √©lectronique", "Safety", "Ing. Syst√®me"], 
                secteurs: ["A√©ronautique", "D√©fense", "A√©rospatial"], 
                seniorite: "Senior", experience: 8, tjmBase: 650,
                periodes: [
                    { debut: "2026-02-10", fin: "2026-04-10", type: "dispo" },
                    { debut: "2026-04-11", fin: "2026-04-26", type: "indispo" }, // Vacances P√¢ques
                    { debut: "2026-04-27", fin: "2026-07-17", type: "dispo" },
                    { debut: "2026-07-18", fin: "2026-08-16", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-17", fin: "2026-10-23", type: "dispo" },
                    { debut: "2026-10-24", fin: "2026-11-01", type: "indispo" }, // Toussaint
                    { debut: "2026-11-02", fin: "2026-12-18", type: "dispo" },
                    { debut: "2026-12-19", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 2, code: "MDUPO", 
                competences: ["Concepteur HW", "Test & Mesure", "Validation"], 
                secteurs: ["Automobile", "A√©ronautique"], 
                seniorite: "Confirm√©", experience: 5, tjmBase: 550,
                periodes: [
                    { debut: "2026-02-01", fin: "2026-02-15", type: "indispo" }, // Fin mission + vacances f√©vrier
                    { debut: "2026-02-16", fin: "2026-05-07", type: "dispo" },
                    { debut: "2026-05-08", fin: "2026-05-17", type: "indispo" }, // Pont mai (8 mai + Ascension)
                    { debut: "2026-05-18", fin: "2026-07-31", type: "dispo" },
                    { debut: "2026-08-01", fin: "2026-08-23", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-24", fin: "2026-12-20", type: "dispo" },
                    { debut: "2026-12-21", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 3, code: "PMART", 
                competences: ["Ing. Syst√®me", "MBSE", "Requirements"], 
                secteurs: ["A√©rospatial"], 
                seniorite: "Junior", experience: 2, tjmBase: 420,
                periodes: [
                    { debut: "2026-02-01", fin: "2026-03-31", type: "indispo" }, // Mission en cours
                    { debut: "2026-04-01", fin: "2026-07-10", type: "dispo" },
                    { debut: "2026-07-11", fin: "2026-08-02", type: "indispo" }, // Cong√©s √©t√© (3 semaines junior)
                    { debut: "2026-08-03", fin: "2026-12-18", type: "dispo" },
                    { debut: "2026-12-19", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 4, code: "SBERN", 
                competences: ["Archi. √©lectronique", "EMC", "Certification"], 
                secteurs: ["D√©fense", "A√©ronautique", "A√©rospatial"], 
                seniorite: "Senior", experience: 12, tjmBase: 720,
                periodes: [
                    { debut: "2026-02-10", fin: "2026-02-22", type: "dispo" },
                    { debut: "2026-02-23", fin: "2026-03-08", type: "indispo" }, // Vacances f√©vrier zone C
                    { debut: "2026-03-09", fin: "2026-06-30", type: "dispo" },
                    { debut: "2026-07-01", fin: "2026-07-26", type: "indispo" }, // Cong√©s √©t√© anticip√©s
                    { debut: "2026-07-27", fin: "2026-10-30", type: "dispo" },
                    { debut: "2026-10-31", fin: "2026-11-08", type: "indispo" }, // Toussaint √©tendu
                    { debut: "2026-11-09", fin: "2026-12-23", type: "dispo" },
                    { debut: "2026-12-24", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 5, code: "TROUX", 
                competences: ["Test & Mesure", "Banc de test", "LabVIEW"], 
                secteurs: ["Automobile", "A√©ronautique"], 
                seniorite: "Confirm√©", experience: 6, tjmBase: 580,
                periodes: [
                    { debut: "2026-02-25", fin: "2026-04-17", type: "dispo" },
                    { debut: "2026-04-18", fin: "2026-04-26", type: "indispo" }, // P√¢ques
                    { debut: "2026-04-27", fin: "2026-08-07", type: "dispo" },
                    { debut: "2026-08-08", fin: "2026-08-30", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-31", fin: "2026-12-31", type: "dispo" }
                ]
            },
            { 
                id: 6, code: "AGARC", 
                competences: ["Software embarqu√©", "C/C++", "AUTOSAR"], 
                secteurs: ["Automobile"], 
                seniorite: "Senior", experience: 10, tjmBase: 680,
                periodes: [
                    { debut: "2026-02-17", fin: "2026-05-21", type: "dispo" },
                    { debut: "2026-05-22", fin: "2026-05-31", type: "indispo" }, // Pont Ascension + week-end
                    { debut: "2026-06-01", fin: "2026-07-24", type: "dispo" },
                    { debut: "2026-07-25", fin: "2026-08-23", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-24", fin: "2026-12-18", type: "dispo" },
                    { debut: "2026-12-19", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 7, code: "LMONN", 
                competences: ["Certification DO-178", "Safety", "ARP4754"], 
                secteurs: ["A√©ronautique", "A√©rospatial"], 
                seniorite: "Senior", experience: 15, tjmBase: 750,
                periodes: [
                    { debut: "2026-02-01", fin: "2026-03-15", type: "indispo" }, // Mission longue en cours
                    { debut: "2026-03-16", fin: "2026-04-10", type: "dispo" },
                    { debut: "2026-04-11", fin: "2026-04-19", type: "indispo" }, // P√¢ques
                    { debut: "2026-04-20", fin: "2026-08-01", type: "dispo" },
                    { debut: "2026-08-02", fin: "2026-08-30", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-31", fin: "2026-12-20", type: "dispo" },
                    { debut: "2026-12-21", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 8, code: "JDURA", 
                competences: ["M√©catronique", "Simulation", "CATIA"], 
                secteurs: ["Automobile", "A√©ronautique"], 
                seniorite: "Confirm√©", experience: 4, tjmBase: 520,
                periodes: [
                    { debut: "2026-02-12", fin: "2026-06-30", type: "dispo" },
                    { debut: "2026-07-01", fin: "2026-07-19", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-07-20", fin: "2026-10-23", type: "dispo" },
                    { debut: "2026-10-24", fin: "2026-11-01", type: "indispo" }, // Toussaint
                    { debut: "2026-11-02", fin: "2026-12-23", type: "dispo" },
                    { debut: "2026-12-24", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 9, code: "CVASS", 
                competences: ["Radar", "Traitement signal", "RF"], 
                secteurs: ["D√©fense"], 
                seniorite: "Senior", experience: 11, tjmBase: 700,
                periodes: [
                    { debut: "2026-02-01", fin: "2026-04-30", type: "indispo" }, // Mission D√©fense longue
                    { debut: "2026-05-01", fin: "2026-07-31", type: "dispo" },
                    { debut: "2026-08-01", fin: "2026-08-23", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-24", fin: "2026-11-06", type: "dispo" },
                    { debut: "2026-11-07", fin: "2026-11-15", type: "indispo" }, // 11 novembre √©tendu
                    { debut: "2026-11-16", fin: "2026-12-20", type: "dispo" },
                    { debut: "2026-12-21", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 10, code: "NBOUD", 
                competences: ["Ing. Syst√®me", "SysML", "DOORS"], 
                secteurs: ["A√©rospatial", "D√©fense"], 
                seniorite: "Confirm√©", experience: 7, tjmBase: 590,
                periodes: [
                    { debut: "2026-02-28", fin: "2026-05-07", type: "dispo" },
                    { debut: "2026-05-08", fin: "2026-05-24", type: "indispo" }, // Ponts de mai
                    { debut: "2026-05-25", fin: "2026-07-17", type: "dispo" },
                    { debut: "2026-07-18", fin: "2026-08-09", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-10", fin: "2026-12-18", type: "dispo" },
                    { debut: "2026-12-19", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 11, code: "RFONT", 
                competences: ["Validation", "HIL", "Banc de test"], 
                secteurs: ["Automobile"], 
                seniorite: "Junior", experience: 3, tjmBase: 450,
                periodes: [
                    { debut: "2026-02-01", fin: "2026-03-31", type: "indispo" }, // Mission en cours
                    { debut: "2026-04-01", fin: "2026-07-24", type: "dispo" },
                    { debut: "2026-07-25", fin: "2026-08-09", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-10", fin: "2026-12-23", type: "dispo" },
                    { debut: "2026-12-24", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 12, code: "EPIER", 
                competences: ["Cybers√©curit√©", "ISO 21434", "TARA"], 
                secteurs: ["Automobile", "D√©fense"], 
                seniorite: "Confirm√©", experience: 5, tjmBase: 620,
                periodes: [
                    { debut: "2026-02-14", fin: "2026-04-17", type: "dispo" },
                    { debut: "2026-04-18", fin: "2026-04-26", type: "indispo" }, // P√¢ques
                    { debut: "2026-04-27", fin: "2026-08-14", type: "dispo" },
                    { debut: "2026-08-15", fin: "2026-09-06", type: "indispo" }, // Cong√©s √©t√© (Assomption)
                    { debut: "2026-09-07", fin: "2026-12-20", type: "dispo" },
                    { debut: "2026-12-21", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 13, code: "HMICH", 
                competences: ["Propulsion", "Thermique", "CFD"], 
                secteurs: ["A√©rospatial", "A√©ronautique"], 
                seniorite: "Senior", experience: 9, tjmBase: 690,
                periodes: [
                    { debut: "2026-02-01", fin: "2026-02-28", type: "indispo" }, // Vacances f√©vrier
                    { debut: "2026-03-01", fin: "2026-06-30", type: "dispo" },
                    { debut: "2026-07-01", fin: "2026-07-12", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-07-13", fin: "2026-08-14", type: "dispo" },
                    { debut: "2026-08-15", fin: "2026-08-30", type: "indispo" }, // Assomption + fin ao√ªt
                    { debut: "2026-08-31", fin: "2026-12-18", type: "dispo" },
                    { debut: "2026-12-19", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 14, code: "YPETI", 
                competences: ["IHM", "Ergonomie", "Qt/QML"], 
                secteurs: ["A√©ronautique", "Automobile", "D√©fense"], 
                seniorite: "Confirm√©", experience: 6, tjmBase: 560,
                periodes: [
                    { debut: "2026-02-21", fin: "2026-05-14", type: "dispo" },
                    { debut: "2026-05-15", fin: "2026-05-24", type: "indispo" }, // Pont Ascension
                    { debut: "2026-05-25", fin: "2026-07-31", type: "dispo" },
                    { debut: "2026-08-01", fin: "2026-08-16", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-17", fin: "2026-10-23", type: "dispo" },
                    { debut: "2026-10-24", fin: "2026-11-01", type: "indispo" }, // Toussaint
                    { debut: "2026-11-02", fin: "2026-12-23", type: "dispo" },
                    { debut: "2026-12-24", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            },
            { 
                id: 15, code: "KLERO", 
                competences: ["√âlectronique puissance", "Batterie", "BMS"], 
                secteurs: ["Automobile", "A√©rospatial"], 
                seniorite: "Junior", experience: 2, tjmBase: 480,
                periodes: [
                    { debut: "2026-02-01", fin: "2026-04-10", type: "indispo" }, // Stage/Mission
                    { debut: "2026-04-11", fin: "2026-07-31", type: "dispo" },
                    { debut: "2026-08-01", fin: "2026-08-16", type: "indispo" }, // Cong√©s √©t√©
                    { debut: "2026-08-17", fin: "2026-12-20", type: "dispo" },
                    { debut: "2026-12-21", fin: "2026-12-31", type: "indispo" } // No√´l
                ]
            }
        ];
        
        const grilleTarifaire = [
            { duree: "1 mois", remise: 0 },
            { duree: "3 mois", remise: 8 },
            { duree: "6 mois", remise: 11 }
        ];
        
        // Configuration par profil (visible + FOMO) - doit √™tre apr√®s consultantsData
        const defaultProfilsConfig = {};
        consultantsData.forEach(c => {
            // Trouver la prochaine p√©riode d'indispo future
            const today = new Date('2026-02-04'); // Date actuelle simul√©e
            const prochaineIndispo = c.periodes.find(p => p.type === 'indispo' && new Date(p.debut) > today);
            
            defaultProfilsConfig[c.id] = {
                visible: true,
                fomo: 'aucun', // 'aucun', 'forte-demande', 'propose-ailleurs', 'dernieres-dispos', 'mission-a-venir'
                prochaineIndispo: prochaineIndispo ? prochaineIndispo.debut : null
            };
        });
        
        const allCompetences = [...new Set(consultantsData.flatMap(c => c.competences))].sort();
        const allSecteurs = ["D√©fense", "A√©ronautique", "A√©rospatial", "Automobile"];
        const secteurIcons = { "D√©fense": "üõ°Ô∏è", "A√©ronautique": "‚úàÔ∏è", "A√©rospatial": "üöÄ", "Automobile": "üöó" };
        
        const Header = ({ client }) => (
            <header style={{ background: 'linear-gradient(135deg, #1a365d 0%, #2c5282 100%)', padding: '16px 32px', display: 'flex', justifyContent: 'space-between', alignItems: 'center', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}>
                <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                    <div style={{ background: 'white', borderRadius: '8px', padding: '8px 16px', fontWeight: 'bold', color: '#1a365d', fontSize: '18px' }}>CENTUM T&S</div>
                    <span style={{ color: 'rgba(255,255,255,0.7)', fontSize: '14px' }}>Portail Partenaires</span>
                </div>
                <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                    <span style={{ color: 'white', fontSize: '14px' }}>Bienvenue, <strong>{client}</strong></span>
                    <button style={{ background: 'rgba(255,255,255,0.15)', border: '1px solid rgba(255,255,255,0.3)', color: 'white', padding: '8px 16px', borderRadius: '6px', cursor: 'pointer', fontSize: '13px' }}>D√©connexion</button>
                </div>
            </header>
        );
        
        const Filtres = ({ filters, setFilters, consultantCount, totalCount }) => (
            <div style={{ background: 'white', padding: '20px 24px', borderRadius: '12px', marginBottom: '24px', boxShadow: '0 2px 8px rgba(0,0,0,0.06)' }}>
                <div style={{ display: 'flex', gap: '16px', flexWrap: 'wrap', alignItems: 'flex-end' }}>
                    <div>
                        <label style={{ display: 'block', fontSize: '11px', fontWeight: '600', color: '#64748b', marginBottom: '6px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Secteur d'activit√©</label>
                        <select value={filters.secteur} onChange={(e) => setFilters({...filters, secteur: e.target.value})} style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', minWidth: '180px', background: 'white' }}>
                            <option value="">Tous les secteurs</option>
                            {allSecteurs.map(s => <option key={s} value={s}>{secteurIcons[s]} {s}</option>)}
                        </select>
                    </div>
                    <div>
                        <label style={{ display: 'block', fontSize: '11px', fontWeight: '600', color: '#64748b', marginBottom: '6px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>Comp√©tences</label>
                        <select value={filters.competence} onChange={(e) => setFilters({...filters, competence: e.target.value})} style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', minWidth: '180px', background: 'white' }}>
                            <option value="">Toutes</option>
                            {allCompetences.map(c => <option key={c} value={c}>{c}</option>)}
                        </select>
                    </div>
                    <div>
                        <label style={{ display: 'block', fontSize: '11px', fontWeight: '600', color: '#64748b', marginBottom: '6px', textTransform: 'uppercase', letterSpacing: '0.5px' }}>S√©niorit√©</label>
                        <select value={filters.seniorite} onChange={(e) => setFilters({...filters, seniorite: e.target.value})} style={{ padding: '10px 14px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', minWidth: '140px', background: 'white' }}>
                            <option value="">Toutes</option>
                            <option value="Junior">Junior</option>
                            <option value="Confirm√©">Confirm√©</option>
                            <option value="Senior">Senior</option>
                        </select>
                    </div>
                    <button onClick={() => setFilters({ competence: '', seniorite: '', secteur: '' })} style={{ padding: '10px 16px', borderRadius: '8px', border: '1px solid #e2e8f0', background: 'white', fontSize: '13px', cursor: 'pointer', color: '#64748b' }}>‚úï R√©initialiser</button>
                    <div style={{ marginLeft: 'auto', color: '#64748b', fontSize: '14px', background: '#f1f5f9', padding: '10px 16px', borderRadius: '8px' }}>
                        <strong style={{ color: '#1a365d', fontSize: '18px' }}>{consultantCount}</strong>
                        <span style={{ color: '#94a3b8' }}> / {totalCount} profils</span>
                    </div>
                </div>
            </div>
        );
        
        // Composant pour une p√©riode avec tooltip
        const PeriodeBar = ({ periode, leftPercent, widthPercent, isDispo, onReserver, formatDateShort }) => {
            const [showTooltip, setShowTooltip] = useState(false);
            
            return (
                <div
                    onClick={() => isDispo && onReserver()}
                    style={{
                        position: 'absolute',
                        left: `${leftPercent}%`,
                        width: `calc(${widthPercent}% - 2px)`,
                        height: '32px',
                        borderRadius: '4px',
                        cursor: isDispo ? 'pointer' : 'default',
                        background: isDispo 
                            ? 'linear-gradient(90deg, #22c55e 0%, #16a34a 100%)'
                            : 'repeating-linear-gradient(45deg, #e2e8f0, #e2e8f0 2px, #d1d5db 2px, #d1d5db 4px)',
                        border: isDispo ? 'none' : '1px solid #cbd5e1',
                        transition: isDispo ? 'transform 0.15s, box-shadow 0.15s' : 'none',
                        boxShadow: isDispo ? '0 1px 3px rgba(0,0,0,0.1)' : 'none',
                        zIndex: showTooltip ? 20 : (isDispo ? 2 : 1)
                    }}
                    onMouseEnter={(e) => {
                        setShowTooltip(true);
                        if (isDispo) {
                            e.currentTarget.style.transform = 'scaleY(1.2)';
                            e.currentTarget.style.boxShadow = '0 4px 12px rgba(34, 197, 94, 0.4)';
                        }
                    }}
                    onMouseLeave={(e) => {
                        setShowTooltip(false);
                        if (isDispo) {
                            e.currentTarget.style.transform = 'scaleY(1)';
                            e.currentTarget.style.boxShadow = '0 1px 3px rgba(0,0,0,0.1)';
                        }
                    }}
                >
                    {showTooltip && (
                        <div style={{
                            position: 'absolute',
                            bottom: '100%',
                            left: '50%',
                            transform: 'translateX(-50%)',
                            marginBottom: '8px',
                            background: isDispo ? '#1a365d' : '#64748b',
                            color: 'white',
                            padding: '8px 12px',
                            borderRadius: '6px',
                            fontSize: '12px',
                            fontWeight: '500',
                            whiteSpace: 'nowrap',
                            boxShadow: '0 4px 12px rgba(0,0,0,0.15)',
                            zIndex: 100
                        }}>
                            {isDispo 
                                ? `${formatDateShort(periode.debut)} ‚Üí ${formatDateShort(periode.fin)}`
                                : `Indisponible : ${formatDateShort(periode.debut)} ‚Üí ${formatDateShort(periode.fin)}`
                            }
                            <div style={{
                                position: 'absolute',
                                top: '100%',
                                left: '50%',
                                transform: 'translateX(-50%)',
                                borderLeft: '6px solid transparent',
                                borderRight: '6px solid transparent',
                                borderTop: `6px solid ${isDispo ? '#1a365d' : '#64748b'}`
                            }}></div>
                        </div>
                    )}
                </div>
            );
        };

        // Timeline V2 - Style Booking - F√©vrier √† D√©cembre 2026 - RESPONSIVE
        const TimelineBooking = ({ consultants, onReserver, config = defaultVisibilityConfig, mode = 'admin', getFomoForConsultant = () => null }) => {
            const startDate = new Date('2026-02-01');
            // Limiter la date de fin selon config
            const monthsToShow = config.moisVisibles || 11;
            const endDate = new Date('2026-02-01');
            endDate.setMonth(endDate.getMonth() + monthsToShow);
            endDate.setDate(0); // Dernier jour du mois pr√©c√©dent
            
            const totalDays = Math.ceil((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            
            // G√©n√©rer les mois
            const months = [];
            let currentMonth = new Date(startDate);
            while (currentMonth <= endDate) {
                const year = currentMonth.getFullYear();
                const month = currentMonth.getMonth();
                const firstOfMonth = new Date(year, month, 1);
                const lastOfMonth = new Date(year, month + 1, 0);
                
                const effectiveStart = firstOfMonth < startDate ? startDate : firstOfMonth;
                const effectiveEnd = lastOfMonth > endDate ? endDate : lastOfMonth;
                
                const daysInView = Math.ceil((effectiveEnd - effectiveStart) / (1000 * 60 * 60 * 24)) + 1;
                
                months.push({
                    key: `${year}-${month}`,
                    name: currentMonth.toLocaleDateString('fr-FR', { month: 'short' }).toUpperCase(),
                    fullName: currentMonth.toLocaleDateString('fr-FR', { month: 'long' }),
                    days: daysInView,
                    widthPercent: (daysInView / totalDays) * 100
                });
                
                currentMonth = new Date(year, month + 1, 1);
            }
            
            const getDayPositionPercent = (dateStr) => {
                const date = new Date(dateStr);
                const clampedDate = date < startDate ? startDate : (date > endDate ? endDate : date);
                const diffTime = clampedDate - startDate;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
                return (diffDays / totalDays) * 100;
            };
            
            const getDayWidthPercent = (startStr, endStr) => {
                const start = new Date(startStr);
                const end = new Date(endStr);
                const effectiveStart = start < startDate ? startDate : start;
                const effectiveEnd = end > endDate ? endDate : end;
                const diffTime = effectiveEnd - effectiveStart;
                const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
                return Math.max(0, (diffDays / totalDays) * 100);
            };
            
            const getSenioriteStyle = (sen) => {
                if (sen === 'Senior') return { bg: '#fef3c7', border: '#f59e0b', text: '#92400e' };
                if (sen === 'Confirm√©') return { bg: '#dbeafe', border: '#3b82f6', text: '#1e40af' };
                return { bg: '#dcfce7', border: '#22c55e', text: '#166534' };
            };
            
            const formatDateShort = (dateStr) => {
                const d = new Date(dateStr);
                return d.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
            };
            
            const sortedConsultants = [...consultants].sort((a, b) => {
                const aFirstDispo = a.periodes.find(p => p.type === 'dispo');
                const bFirstDispo = b.periodes.find(p => p.type === 'dispo');
                if (!aFirstDispo) return 1;
                if (!bFirstDispo) return -1;
                return new Date(aFirstDispo.debut) - new Date(bFirstDispo.debut);
            });
            
            return (
                <div style={{ background: 'white', borderRadius: '16px', boxShadow: '0 2px 12px rgba(0,0,0,0.08)', overflow: 'hidden' }}>
                    {/* Header */}
                    <div style={{ background: '#1a365d', color: 'white', padding: '16px 20px', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                            <span style={{ fontSize: '24px' }}>üóìÔ∏è</span>
                            <div>
                                <div style={{ fontWeight: '600', fontSize: '16px' }}>Plan de charge 2026</div>
                                <div style={{ fontSize: '12px', opacity: 0.8 }}>Cliquez sur une p√©riode verte pour r√©server</div>
                            </div>
                        </div>
                        <div style={{ display: 'flex', gap: '20px', fontSize: '12px' }}>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                                <div style={{ width: '24px', height: '12px', background: 'linear-gradient(90deg, #22c55e 0%, #16a34a 100%)', borderRadius: '3px' }}></div>
                                Disponible
                            </div>
                            <div style={{ display: 'flex', alignItems: 'center', gap: '6px' }}>
                                <div style={{ width: '24px', height: '12px', background: 'repeating-linear-gradient(45deg, #e2e8f0, #e2e8f0 2px, #cbd5e1 2px, #cbd5e1 4px)', borderRadius: '3px' }}></div>
                                Indisponible
                            </div>
                        </div>
                    </div>
                    
                    <div style={{ display: 'flex', flexDirection: 'column' }}>
                        {/* Header mois */}
                        <div style={{ display: 'flex', background: '#f8fafc', borderBottom: '2px solid #e2e8f0' }}>
                            <div style={{ width: '220px', minWidth: '220px', padding: '12px 16px', fontSize: '11px', fontWeight: '600', color: '#64748b', textTransform: 'uppercase', borderRight: '1px solid #e2e8f0', background: '#f8fafc' }}>
                                Consultant
                            </div>
                            <div style={{ flex: 1, display: 'flex' }}>
                                {months.map((m, i) => (
                                    <div key={m.key} style={{
                                        width: `${m.widthPercent}%`,
                                        textAlign: 'center',
                                        padding: '12px 0',
                                        fontWeight: '600',
                                        color: '#1a365d',
                                        fontSize: '11px',
                                        borderRight: '1px solid #cbd5e1',
                                        background: i % 2 === 0 ? '#f8fafc' : '#f1f5f9'
                                    }}>
                                        {m.name}
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        {/* Consultants */}
                        {sortedConsultants.map((c, idx) => {
                            const style = getSenioriteStyle(c.seniorite);
                            const fomo = mode === 'client' ? getFomoForConsultant(c.id) : null;
                            
                            return (
                                <div key={c.id} style={{ display: 'flex', borderBottom: '1px solid #f1f5f9', background: idx % 2 === 0 ? 'white' : '#fafbfc', position: 'relative' }}>
                                    {/* Badge FOMO */}
                                    {fomo && (
                                        <div style={{
                                            position: 'absolute',
                                            top: '4px',
                                            left: '4px',
                                            background: fomo.color,
                                            color: 'white',
                                            padding: '2px 8px',
                                            borderRadius: '4px',
                                            fontSize: '9px',
                                            fontWeight: '700',
                                            zIndex: 5
                                        }}>
                                            üî• {fomo.badge}
                                        </div>
                                    )}
                                    {/* Info consultant */}
                                    <div style={{ width: '220px', minWidth: '220px', padding: fomo ? '18px 12px 10px' : '10px 12px', display: 'flex', alignItems: 'center', gap: '10px', borderRight: '1px solid #e2e8f0' }}>
                                        <div 
                                            onClick={() => onReserver(c, null)}
                                            style={{ background: style.bg, border: `2px solid ${style.border}`, color: style.text, padding: '6px 8px', borderRadius: '6px', fontWeight: 'bold', fontSize: '11px', minWidth: '52px', textAlign: 'center', cursor: 'pointer', transition: 'transform 0.15s' }}
                                            onMouseEnter={(e) => e.currentTarget.style.transform = 'scale(1.05)'}
                                            onMouseLeave={(e) => e.currentTarget.style.transform = 'scale(1)'}
                                            title="Cliquez pour voir ce profil"
                                        >
                                            {c.code}
                                        </div>
                                        <div style={{ flex: 1, minWidth: 0 }}>
                                            <div style={{ fontSize: '11px', color: '#374151', fontWeight: '500' }}>
                                                {c.seniorite} {config.afficherTJM && <>‚Ä¢ <strong>{c.tjmBase}‚Ç¨</strong>/j</>}
                                            </div>
                                            <div style={{ fontSize: '9px', color: '#9ca3af', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>
                                                {c.secteurs.map(s => secteurIcons[s]).join('')} {c.competences[0]}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    {/* Timeline responsive */}
                                    <div style={{ flex: 1, position: 'relative', height: '48px', display: 'flex', alignItems: 'center' }}>
                                        {/* Fond mois */}
                                        <div style={{ display: 'flex', height: '100%', position: 'absolute', left: 0, right: 0, top: 0 }}>
                                            {months.map((m, i) => (
                                                <div key={m.key} style={{
                                                    width: `${m.widthPercent}%`,
                                                    background: i % 2 === 0 ? 'transparent' : 'rgba(241,245,249,0.5)',
                                                    borderRight: '1px solid #e2e8f0'
                                                }}></div>
                                            ))}
                                        </div>
                                        
                                        {/* P√©riodes en pourcentage */}
                                        {c.periodes.map((p, pIdx) => {
                                            const leftPercent = getDayPositionPercent(p.debut);
                                            const widthPercent = getDayWidthPercent(p.debut, p.fin);
                                            const isDispo = p.type === 'dispo';
                                            
                                            if (widthPercent <= 0) return null;
                                            
                                            return (
                                                <PeriodeBar
                                                    key={pIdx}
                                                    periode={p}
                                                    leftPercent={leftPercent}
                                                    widthPercent={widthPercent}
                                                    isDispo={isDispo}
                                                    onReserver={() => onReserver(c, p)}
                                                    formatDateShort={formatDateShort}
                                                />
                                            );
                                        })}
                                    </div>
                                </div>
                            );
                        })}
                    </div>
                    
                    {/* Footer */}
                    <div style={{ padding: '14px 20px', background: '#f8fafc', borderTop: '1px solid #e2e8f0', display: 'flex', justifyContent: 'space-between', fontSize: '12px', color: '#64748b' }}>
                        <div style={{ display: 'flex', gap: '24px' }}>
                            <span>üí° Survolez une p√©riode pour voir les dates, cliquez pour r√©server</span>
                        </div>
                        <div>F√©vrier ‚Üí D√©cembre 2026</div>
                    </div>
                </div>
            );
        };
        
        const ViewToggle = ({ view, setView }) => (
            <div style={{ display: 'flex', background: '#e2e8f0', borderRadius: '10px', padding: '4px' }}>
                <button onClick={() => setView('timeline')} style={{ padding: '10px 20px', borderRadius: '8px', border: 'none', background: view === 'timeline' ? 'white' : 'transparent', color: view === 'timeline' ? '#1a365d' : '#64748b', fontWeight: view === 'timeline' ? '600' : '400', cursor: 'pointer', fontSize: '14px', display: 'flex', alignItems: 'center', gap: '8px', boxShadow: view === 'timeline' ? '0 2px 4px rgba(0,0,0,0.1)' : 'none' }}>
                    <span>üóìÔ∏è</span> Planning
                </button>
                <button onClick={() => setView('cards')} style={{ padding: '10px 20px', borderRadius: '8px', border: 'none', background: view === 'cards' ? 'white' : 'transparent', color: view === 'cards' ? '#1a365d' : '#64748b', fontWeight: view === 'cards' ? '600' : '400', cursor: 'pointer', fontSize: '14px', display: 'flex', alignItems: 'center', gap: '8px', boxShadow: view === 'cards' ? '0 2px 4px rgba(0,0,0,0.1)' : 'none' }}>
                    <span>‚ñ¶</span> Fiches
                </button>
            </div>
        );
        
        const ConsultantCard = ({ consultant, onInteret, config = defaultVisibilityConfig, mode = 'admin', fomo = null }) => {
            const calcTJM = (base, remise) => Math.round(base * (1 - remise / 100));
            const firstDispo = consultant.periodes.find(p => p.type === 'dispo');
            
            return (
                <div style={{ background: 'white', borderRadius: '16px', padding: '24px', boxShadow: '0 2px 12px rgba(0,0,0,0.08)', display: 'flex', flexDirection: 'column', gap: '14px', transition: 'transform 0.2s, box-shadow 0.2s', position: 'relative' }}
                    onMouseEnter={(e) => { e.currentTarget.style.transform = 'translateY(-4px)'; e.currentTarget.style.boxShadow = '0 8px 24px rgba(0,0,0,0.12)'; }}
                    onMouseLeave={(e) => { e.currentTarget.style.transform = 'translateY(0)'; e.currentTarget.style.boxShadow = '0 2px 12px rgba(0,0,0,0.08)'; }}>
                    
                    {/* Badge FOMO */}
                    {fomo && (
                        <div style={{
                            position: 'absolute',
                            top: '-10px',
                            right: '16px',
                            background: fomo.color,
                            color: 'white',
                            padding: '6px 12px',
                            borderRadius: '6px',
                            fontSize: '11px',
                            fontWeight: '700',
                            boxShadow: '0 2px 8px rgba(0,0,0,0.2)',
                            zIndex: 5
                        }}>
                            üî• {fomo.badge}
                        </div>
                    )}
                    
                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>
                        <div>
                            <div style={{ fontSize: '26px', fontWeight: 'bold', color: '#1a365d', letterSpacing: '2px' }}>{consultant.code}</div>
                            <div style={{ fontSize: '13px', color: '#64748b', marginTop: '4px' }}>{consultant.seniorite} ‚Ä¢ {consultant.experience} ans d'exp.</div>
                        </div>
                        <div style={{ background: consultant.seniorite === 'Senior' ? '#fef3c7' : consultant.seniorite === 'Confirm√©' ? '#dbeafe' : '#dcfce7', color: consultant.seniorite === 'Senior' ? '#92400e' : consultant.seniorite === 'Confirm√©' ? '#1e40af' : '#166534', padding: '5px 10px', borderRadius: '20px', fontSize: '11px', fontWeight: '600' }}>{consultant.seniorite}</div>
                    </div>
                    <div style={{ display: 'flex', gap: '6px', flexWrap: 'wrap' }}>
                        {consultant.secteurs.map(s => <span key={s} style={{ background: '#f8fafc', border: '1px solid #e2e8f0', padding: '4px 8px', borderRadius: '4px', fontSize: '11px', color: '#475569' }}>{secteurIcons[s]} {s}</span>)}
                    </div>
                    <div style={{ display: 'flex', flexWrap: 'wrap', gap: '6px' }}>
                        {consultant.competences.map(comp => <span key={comp} style={{ background: '#eff6ff', color: '#1e40af', padding: '5px 10px', borderRadius: '6px', fontSize: '12px', fontWeight: '500' }}>{comp}</span>)}
                    </div>
                    
                    {/* Mini timeline dans la card */}
                    <div style={{ background: '#f8fafc', borderRadius: '8px', padding: '12px', border: '1px solid #e2e8f0' }}>
                        <div style={{ fontSize: '11px', fontWeight: '600', color: '#64748b', marginBottom: '8px', textTransform: 'uppercase' }}>Prochaines disponibilit√©s</div>
                        <div style={{ display: 'flex', gap: '4px', flexWrap: 'wrap' }}>
                            {consultant.periodes.filter(p => p.type === 'dispo').slice(0, 3).map((p, i) => {
                                const debut = new Date(p.debut).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                                const fin = new Date(p.fin).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                                return (
                                    <span key={i} style={{
                                        padding: '4px 8px',
                                        borderRadius: '4px',
                                        fontSize: '10px',
                                        fontWeight: '500',
                                        background: '#dcfce7',
                                        color: '#166534',
                                        border: '1px solid #bbf7d0'
                                    }}>
                                        {debut} ‚Üí {fin}
                                    </span>
                                );
                            })}
                        </div>
                    </div>
                    
                    {/* Grille tarifaire - seulement si config.afficherGrilleTarifaire */}
                    {config.afficherGrilleTarifaire && (
                        <div style={{ background: '#f8fafc', borderRadius: '10px', padding: '14px', border: '1px solid #e2e8f0' }}>
                            <div style={{ fontSize: '11px', fontWeight: '600', color: '#64748b', marginBottom: '10px', textTransform: 'uppercase' }}>Tarif journalier selon engagement</div>
                            <div style={{ display: 'flex', justifyContent: 'space-between' }}>
                                {grilleTarifaire.map(g => (
                                    <div key={g.duree} style={{ textAlign: 'center', flex: 1 }}>
                                        <div style={{ fontSize: '11px', color: '#94a3b8', marginBottom: '4px' }}>{g.duree}</div>
                                        <div style={{ fontSize: '18px', fontWeight: 'bold', color: '#1a365d' }}>{calcTJM(consultant.tjmBase, g.remise)} ‚Ç¨</div>
                                        {g.remise > 0 && config.afficherRemises && <div style={{ fontSize: '10px', color: '#10b981', fontWeight: '600' }}>-{g.remise}%</div>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    )}
                    <button onClick={() => firstDispo && onInteret(consultant, firstDispo)} style={{ background: 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)', color: 'white', border: 'none', padding: '12px 20px', borderRadius: '10px', fontSize: '14px', fontWeight: '600', cursor: 'pointer', marginTop: 'auto' }}
                        onMouseEnter={(e) => { e.currentTarget.style.transform = 'scale(1.02)'; e.currentTarget.style.boxShadow = '0 4px 12px rgba(37, 99, 235, 0.4)'; }}
                        onMouseLeave={(e) => { e.currentTarget.style.transform = 'scale(1)'; e.currentTarget.style.boxShadow = 'none'; }}>
                        Je suis int√©ress√© ‚Üí
                    </button>
                </div>
            );
        };
        
        const ModalReservation = ({ consultant, periode, onClose, onSubmit, config = defaultVisibilityConfig, mode = 'admin' }) => {
            // Date d'aujourd'hui (simul√©e)
            const TODAY = '2026-02-04';
            const todayDate = new Date(TODAY);
            
            // Trouver la premi√®re p√©riode dispo qui commence apr√®s aujourd'hui ou qui contient aujourd'hui
            const getFirstValidDispo = () => {
                for (const p of consultant?.periodes || []) {
                    if (p.type !== 'dispo') continue;
                    const pEnd = new Date(p.fin);
                    if (pEnd >= todayDate) {
                        // La p√©riode est encore valide (se termine apr√®s aujourd'hui)
                        const pStart = new Date(p.debut);
                        // Retourner la date max entre d√©but p√©riode et aujourd'hui
                        return pStart < todayDate ? TODAY : p.debut;
                    }
                }
                return null;
            };
            
            const firstValidDispo = getFirstValidDispo();
            const lastPeriode = consultant?.periodes[consultant.periodes.length - 1];
            
            // V√©rifier si une date est dans une p√©riode dispo
            const isDateInDispo = (dateStr) => {
                if (!dateStr) return false;
                const date = new Date(dateStr);
                return consultant?.periodes.some(p => {
                    if (p.type !== 'dispo') return false;
                    const pStart = new Date(p.debut);
                    const pEnd = new Date(p.fin);
                    return date >= pStart && date <= pEnd;
                });
            };
            
            // Trouver la prochaine date dispo √† partir d'une date donn√©e
            const findNextDispoDate = (fromDateStr) => {
                const fromDate = new Date(fromDateStr);
                for (const p of consultant?.periodes || []) {
                    if (p.type !== 'dispo') continue;
                    const pStart = new Date(p.debut);
                    const pEnd = new Date(p.fin);
                    if (pEnd < fromDate) continue; // P√©riode pass√©e
                    if (pStart <= fromDate && pEnd >= fromDate) {
                        // On est dans cette p√©riode dispo
                        return fromDateStr;
                    }
                    if (pStart > fromDate) {
                        // Prochaine p√©riode dispo future
                        return p.debut;
                    }
                }
                return null;
            };
            
            // D√©terminer la date de d√©but initiale
            const getInitialDateDebut = () => {
                if (periode?.debut) {
                    // Si la p√©riode pass√©e est valide et apr√®s aujourd'hui
                    if (new Date(periode.debut) >= todayDate && isDateInDispo(periode.debut)) {
                        return periode.debut;
                    }
                }
                return firstValidDispo || '';
            };
            
            const [dateDebut, setDateDebut] = useState(getInitialDateDebut());
            const [dateFin, setDateFin] = useState(periode?.fin || lastPeriode?.fin || '');
            const [commentaire, setCommentaire] = useState('');
            const [dateDebutError, setDateDebutError] = useState('');
            
            if (!consultant) return null;
            
            const calcTJM = (base, remise) => Math.round(base * (1 - remise / 100));
            
            // Calculer les jours facturables (jours ouvr√©s hors indispos)
            const calculerJoursFacturables = () => {
                if (!dateDebut || !dateFin) return { calendaires: 0, ouvres: 0, facturables: 0, indispos: [] };
                
                const start = new Date(dateDebut);
                const end = new Date(dateFin);
                const joursCalendaires = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
                
                // Jours f√©ri√©s France 2026
                const feriesFrance2026 = [
                    '2026-01-01', // Jour de l'an
                    '2026-04-06', // Lundi de P√¢ques
                    '2026-05-01', // F√™te du travail
                    '2026-05-08', // Victoire 1945
                    '2026-05-14', // Ascension
                    '2026-05-25', // Lundi de Pentec√¥te
                    '2026-07-14', // F√™te nationale
                    '2026-08-15', // Assomption
                    '2026-11-01', // Toussaint
                    '2026-11-11', // Armistice
                    '2026-12-25', // No√´l
                ];
                
                // Compter les jours ouvr√©s (hors week-ends et f√©ri√©s)
                let joursOuvres = 0;
                let currentDate = new Date(start);
                while (currentDate <= end) {
                    const dayOfWeek = currentDate.getDay();
                    const dateStr = currentDate.toISOString().split('T')[0];
                    if (dayOfWeek !== 0 && dayOfWeek !== 6 && !feriesFrance2026.includes(dateStr)) {
                        joursOuvres++;
                    }
                    currentDate.setDate(currentDate.getDate() + 1);
                }
                
                // Calculer les jours d'indispo (en jours ouvr√©s)
                let joursIndispoOuvres = 0;
                const indispos = [];
                
                consultant.periodes.filter(p => p.type === 'indispo').forEach(p => {
                    const pStart = new Date(p.debut);
                    const pEnd = new Date(p.fin);
                    
                    // Chevauchement avec la p√©riode s√©lectionn√©e
                    const overlapStart = pStart < start ? start : pStart;
                    const overlapEnd = pEnd > end ? end : pEnd;
                    
                    if (overlapStart <= overlapEnd) {
                        // Compter jours ouvr√©s dans cette p√©riode d'indispo
                        let joursOuvresIndispo = 0;
                        let d = new Date(overlapStart);
                        while (d <= overlapEnd) {
                            const dayOfWeek = d.getDay();
                            const dateStr = d.toISOString().split('T')[0];
                            if (dayOfWeek !== 0 && dayOfWeek !== 6 && !feriesFrance2026.includes(dateStr)) {
                                joursOuvresIndispo++;
                            }
                            d.setDate(d.getDate() + 1);
                        }
                        
                        if (joursOuvresIndispo > 0) {
                            joursIndispoOuvres += joursOuvresIndispo;
                            indispos.push({
                                debut: overlapStart.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }),
                                fin: overlapEnd.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }),
                                jours: joursOuvresIndispo
                            });
                        }
                    }
                });
                
                return {
                    calendaires: joursCalendaires,
                    ouvres: joursOuvres,
                    facturables: Math.max(0, joursOuvres - joursIndispoOuvres),
                    indispos
                };
            };
            
            const { calendaires, ouvres, facturables, indispos } = calculerJoursFacturables();
            const tauxOccupation = ouvres > 0 ? Math.round((facturables / ouvres) * 100) : 0;
            const dureeMois = facturables / 22; // ~22 jours ouvr√©s par mois
            const remise = dureeMois >= 6 ? 11 : dureeMois >= 3 ? 8 : 0;
            const tjmApplique = calcTJM(consultant.tjmBase, remise);
            const montantTotal = facturables * tjmApplique;
            
            // Jours f√©ri√©s France 2026 (r√©utilis√© pour le calcul)
            const feriesFrance2026 = [
                '2026-01-01', '2026-04-06', '2026-05-01', '2026-05-08', 
                '2026-05-14', '2026-05-25', '2026-07-14', '2026-08-15',
                '2026-11-01', '2026-11-11', '2026-12-25'
            ];
            
            // Fonction pour compter les jours ouvr√©s entre deux dates (hors indispos consultant)
            const compterJoursFacturables = (debut, fin) => {
                let count = 0;
                let d = new Date(debut);
                const endDate = new Date(fin);
                
                while (d <= endDate) {
                    const dayOfWeek = d.getDay();
                    const dateStr = d.toISOString().split('T')[0];
                    
                    // Jour ouvr√© ?
                    if (dayOfWeek !== 0 && dayOfWeek !== 6 && !feriesFrance2026.includes(dateStr)) {
                        // Pas dans une p√©riode d'indispo ?
                        const estIndispo = consultant.periodes.some(p => {
                            if (p.type !== 'indispo') return false;
                            const pStart = new Date(p.debut);
                            const pEnd = new Date(p.fin);
                            return d >= pStart && d <= pEnd;
                        });
                        
                        if (!estIndispo) count++;
                    }
                    d.setDate(d.getDate() + 1);
                }
                return count;
            };
            
            // Trouver la date exacte pour atteindre X jours facturables
            const trouverDatePourJours = (dateDebut, joursOuvresCible) => {
                let d = new Date(dateDebut);
                let count = 0;
                
                // Limite √† 1 an pour √©viter boucle infinie
                const maxDate = new Date(dateDebut);
                maxDate.setFullYear(maxDate.getFullYear() + 1);
                
                while (count < joursOuvresCible && d <= maxDate) {
                    const dayOfWeek = d.getDay();
                    const dateStr = d.toISOString().split('T')[0];
                    
                    if (dayOfWeek !== 0 && dayOfWeek !== 6 && !feriesFrance2026.includes(dateStr)) {
                        const estIndispo = consultant.periodes.some(p => {
                            if (p.type !== 'indispo') return false;
                            const pStart = new Date(p.debut);
                            const pEnd = new Date(p.fin);
                            return d >= pStart && d <= pEnd;
                        });
                        
                        if (!estIndispo) count++;
                    }
                    
                    if (count < joursOuvresCible) {
                        d.setDate(d.getDate() + 1);
                    }
                }
                return d.toISOString().split('T')[0];
            };
            
            // State pour tracker si l'utilisateur a d√©j√† optimis√©
            const [aAtteintPalier, setAAtteintPalier] = useState(false);
            const [aAtteintFinMois, setAAtteintFinMois] = useState(false);
            
            // Validation des dates (doit √™tre avant getProchainPalier)
            const datesValides = dateDebut && dateFin && new Date(dateDebut) <= new Date(dateFin) && !dateDebutError;
            const dateDebutSuperieure = dateDebut && dateFin && new Date(dateDebut) > new Date(dateFin);
            
            // Reset les flags si la date de d√©but change manuellement
            React.useEffect(() => {
                setAAtteintPalier(false);
                setAAtteintFinMois(false);
            }, [dateDebut]);
            
            // Calcul prochain palier (seulement le prochain, pas le max)
            const getProchainPalier = () => {
                if (!datesValides) return null;
                if (aAtteintFinMois) return null;
                
                // Si on a atteint le palier, proposer fin de mois
                if (aAtteintPalier) {
                    const dateFinActuelle = new Date(dateFin);
                    const finDeMois = new Date(dateFinActuelle.getFullYear(), dateFinActuelle.getMonth() + 1, 0);
                    const jourActuel = dateFinActuelle.getDate();
                    const joursDuMois = finDeMois.getDate();
                    
                    // Proposer fin de mois seulement si on n'y est pas d√©j√†
                    if (jourActuel < joursDuMois) {
                        return {
                            type: 'finMois',
                            dateFinMois: finDeMois.toISOString().split('T')[0],
                            moisLabel: finDeMois.toLocaleDateString('fr-FR', { month: 'long' })
                        };
                    }
                    return null;
                }
                
                // Sinon proposer le prochain palier
                if (remise >= 11) return null; // D√©j√† au max
                
                const palierCible = remise === 0 ? 3 : 6;
                const joursOuvresCible = palierCible * 22; // 66j ou 132j
                const joursManquants = joursOuvresCible - facturables;
                
                if (joursManquants <= 0) return null;
                if (joursManquants > 66) return null; // Trop loin (> 3 mois), pas pertinent
                
                // Trouver la date exacte
                const dateCible = trouverDatePourJours(dateDebut, joursOuvresCible);
                const remiseCible = palierCible >= 6 ? 11 : 8;
                
                return {
                    type: 'palier',
                    palier: palierCible,
                    remiseCible,
                    joursManquants,
                    dateCible,
                    labelPalier: palierCible >= 6 ? '6 mois' : '3 mois'
                };
            };
            
            const prochainPalier = getProchainPalier();
            
            const handleEtendrePalier = (date) => {
                setDateFin(date);
                setAAtteintPalier(true);
            };
            
            const handleEtendreFinMois = (date) => {
                setDateFin(date);
                setAAtteintFinMois(true);
            };
            
            // Ajuster dateFin si dateDebut change et devient sup√©rieure
            const handleDateDebutChange = (newDateDebut) => {
                // Validation 1: pas avant aujourd'hui
                if (new Date(newDateDebut) < new Date(TODAY)) {
                    setDateDebutError(`La date doit √™tre √† partir du ${new Date(TODAY).toLocaleDateString('fr-FR')}`);
                    return;
                }
                
                // Validation 2: doit √™tre dans une p√©riode dispo
                if (!isDateInDispo(newDateDebut)) {
                    const nextDispo = findNextDispoDate(newDateDebut);
                    if (nextDispo) {
                        setDateDebutError(`Cette date est en p√©riode d'indisponibilit√©. Prochaine dispo: ${new Date(nextDispo).toLocaleDateString('fr-FR')}`);
                    } else {
                        setDateDebutError(`Aucune disponibilit√© √† cette date`);
                    }
                    return;
                }
                
                setDateDebutError('');
                setDateDebut(newDateDebut);
                if (dateFin && new Date(newDateDebut) > new Date(dateFin)) {
                    setDateFin(newDateDebut);
                }
            };
            
            // Labels explicatifs pour les remises
            const getRemiseExplication = () => {
                if (remise === 11) return "Remise maximale pour engagement ‚â• 6 mois";
                if (remise === 8) return "Remise pour engagement ‚â• 3 mois";
                return "Tarif standard (engagement < 3 mois)";
            };
            
            return (
                <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }} onClick={onClose}>
                    <div style={{ background: 'white', borderRadius: '20px', padding: '32px', maxWidth: '560px', width: '90%', maxHeight: '90vh', overflow: 'auto' }} onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '24px' }}>
                            <h2 style={{ fontSize: '20px', color: '#1a365d', margin: 0 }}>Exprimer mon int√©r√™t</h2>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '24px', cursor: 'pointer', color: '#94a3b8' }}>√ó</button>
                        </div>
                        
                        <div style={{ background: '#f8fafc', border: '1px solid #e2e8f0', padding: '16px', borderRadius: '12px', marginBottom: '24px', display: 'flex', alignItems: 'center', gap: '16px' }}>
                            <div style={{ background: '#1a365d', color: 'white', width: '56px', height: '56px', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center', fontWeight: 'bold', fontSize: '14px' }}>{consultant.code}</div>
                            <div>
                                <div style={{ fontWeight: '600', color: '#1a365d' }}>{consultant.seniorite} ‚Ä¢ {consultant.experience} ans{config.afficherTJM && ` ‚Ä¢ ${consultant.tjmBase}‚Ç¨/j`}</div>
                                <div style={{ fontSize: '13px', color: '#64748b' }}>{consultant.competences.join(', ')}</div>
                            </div>
                        </div>
                        
                        <div style={{ background: '#eff6ff', padding: '12px 16px', borderRadius: '8px', marginBottom: '20px', fontSize: '13px', color: '#1e40af' }}>
                            üí° Indiquez la p√©riode souhait√©e. Les indisponibilit√©s sont automatiquement exclues du calcul.
                        </div>
                        
                        <div style={{ display: 'flex', gap: '16px', marginBottom: '20px' }}>
                            <div style={{ flex: 1 }}>
                                <label style={{ display: 'block', fontSize: '14px', fontWeight: '600', color: '#374151', marginBottom: '8px' }}>Date de d√©but</label>
                                <input type="date" value={dateDebut} min={TODAY} onChange={(e) => handleDateDebutChange(e.target.value)} style={{ width: '100%', padding: '12px 14px', borderRadius: '8px', border: dateDebutError ? '2px solid #dc2626' : '1px solid #e2e8f0', fontSize: '14px' }} />
                                {dateDebutError && (
                                    <div style={{ color: '#dc2626', fontSize: '11px', marginTop: '6px' }}>‚ö†Ô∏è {dateDebutError}</div>
                                )}
                            </div>
                            <div style={{ flex: 1 }}>
                                <label style={{ display: 'block', fontSize: '14px', fontWeight: '600', color: '#374151', marginBottom: '8px' }}>Date de fin</label>
                                <input type="date" value={dateFin} min={dateDebut || TODAY} onChange={(e) => setDateFin(e.target.value)} style={{ width: '100%', padding: '12px 14px', borderRadius: '8px', border: dateDebutSuperieure ? '2px solid #dc2626' : '1px solid #e2e8f0', fontSize: '14px' }} />
                            </div>
                        </div>
                        
                        {/* Message d'erreur si dates invalides */}
                        {dateDebutSuperieure && (
                            <div style={{ background: '#fef2f2', border: '1px solid #fecaca', borderRadius: '8px', padding: '12px', marginBottom: '20px', fontSize: '13px', color: '#dc2626', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                ‚ö†Ô∏è La date de fin doit √™tre post√©rieure √† la date de d√©but
                            </div>
                        )}
                        
                        {datesValides && calendaires > 0 && (
                            <>
                                {/* R√©sum√© des indispos */}
                                {indispos.length > 0 && (
                                    <div style={{ background: '#fef3c7', border: '1px solid #fbbf24', borderRadius: '10px', padding: '14px', marginBottom: '16px' }}>
                                        <div style={{ fontSize: '12px', fontWeight: '600', color: '#92400e', marginBottom: '8px' }}>‚ö†Ô∏è P√©riodes d'indisponibilit√© dans votre s√©lection :</div>
                                        <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                                            {indispos.map((ind, i) => (
                                                <span key={i} style={{ background: 'white', padding: '4px 10px', borderRadius: '4px', fontSize: '11px', color: '#92400e', border: '1px solid #fbbf24' }}>
                                                    {ind.debut} ‚Üí {ind.fin} ({ind.jours}j)
                                                </span>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                
                                {/* Calcul facturation - conditionn√© par config */}
                                {(config.afficherBudget || config.afficherTJM || config.afficherTauxOccupation) && (
                                <div style={{ background: '#f0fdf4', border: '2px solid #22c55e', borderRadius: '12px', padding: '20px', marginBottom: '20px' }}>
                                    <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: '16px' }}>
                                        <div style={{ textAlign: 'center', flex: 1 }}>
                                            <div style={{ fontSize: '12px', color: '#64748b', marginBottom: '4px' }}>Calendaires</div>
                                            <div style={{ fontSize: '20px', fontWeight: '600', color: '#94a3b8' }}>{calendaires}j</div>
                                        </div>
                                        <div style={{ color: '#94a3b8', fontSize: '18px' }}>‚Üí</div>
                                        <div style={{ textAlign: 'center', flex: 1 }}>
                                            <div style={{ fontSize: '12px', color: '#64748b', marginBottom: '4px' }}>Jours ouvr√©s</div>
                                            <div style={{ fontSize: '20px', fontWeight: '600', color: '#374151' }}>{ouvres}j</div>
                                        </div>
                                        <div style={{ color: '#dc2626', fontSize: '18px', fontWeight: '600' }}>‚àí</div>
                                        <div style={{ textAlign: 'center', flex: 1 }}>
                                            <div style={{ fontSize: '12px', color: '#64748b', marginBottom: '4px' }}>Indisponibles</div>
                                            <div style={{ fontSize: '20px', fontWeight: '600', color: '#dc2626' }}>{ouvres - facturables}j</div>
                                        </div>
                                        <div style={{ color: '#16a34a', fontSize: '18px', fontWeight: '600' }}>=</div>
                                        <div style={{ textAlign: 'center', flex: 1, background: '#dcfce7', padding: '12px 16px', borderRadius: '8px' }}>
                                            <div style={{ fontSize: '12px', color: '#16a34a', fontWeight: '600', marginBottom: '4px' }}>Facturables</div>
                                            <div style={{ fontSize: '24px', fontWeight: '700', color: '#16a34a' }}>{facturables}j</div>
                                            {config.afficherTauxOccupation && <div style={{ fontSize: '11px', color: '#166534', fontWeight: '500' }}>{tauxOccupation}% de la p√©riode</div>}
                                        </div>
                                    </div>
                                    {(config.afficherTJM || config.afficherBudget) && (
                                    <div style={{ borderTop: '1px solid #bbf7d0', paddingTop: '16px', display: 'flex', justifyContent: 'space-between', alignItems: 'flex-end' }}>
                                        {config.afficherTJM && (
                                        <div>
                                            <div style={{ fontSize: '13px', color: '#64748b', marginBottom: '2px' }}>Tarif applicable</div>
                                            <div style={{ fontSize: '20px', fontWeight: '600', color: '#1a365d' }}>
                                                {tjmApplique} ‚Ç¨<span style={{ fontSize: '14px', fontWeight: '400' }}>/jour</span>
                                                {remise > 0 && config.afficherRemises && <span style={{ fontSize: '12px', color: '#10b981', marginLeft: '8px' }}>(-{remise}%)</span>}
                                            </div>
                                            {config.afficherRemises && <div style={{ fontSize: '11px', color: '#64748b', marginTop: '2px' }}>{getRemiseExplication()}</div>}
                                        </div>
                                        )}
                                        {config.afficherBudget && (
                                        <div style={{ textAlign: 'right' }}>
                                            <div style={{ fontSize: '13px', color: '#64748b', marginBottom: '2px' }}>Budget indicatif</div>
                                            <div style={{ fontSize: '28px', fontWeight: '700', color: '#1a365d' }}>{montantTotal.toLocaleString('fr-FR')} ‚Ç¨</div>
                                            {config.afficherTJM && <div style={{ fontSize: '11px', color: '#64748b' }}>{facturables}j √ó {tjmApplique}‚Ç¨</div>}
                                        </div>
                                        )}
                                    </div>
                                    )}
                                </div>
                                )}
                                
                                {/* Teaser prochain palier - seulement si remises affich√©es */}
                                {config.afficherRemises && prochainPalier && prochainPalier.type === 'palier' && (
                                    <div style={{ background: '#fef3c7', border: '1px solid #fbbf24', borderRadius: '10px', padding: '16px', marginBottom: '20px' }}>
                                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '12px' }}>
                                            <div style={{ fontSize: '13px', color: '#92400e' }}>
                                                üí° <strong>~{prochainPalier.joursManquants}j</strong> de plus pour <strong>-{prochainPalier.remiseCible}%</strong>
                                            </div>
                                            <button 
                                                onClick={() => handleEtendrePalier(prochainPalier.dateCible)}
                                                style={{ 
                                                    padding: '8px 14px', 
                                                    borderRadius: '6px', 
                                                    border: 'none', 
                                                    background: '#f59e0b', 
                                                    color: 'white', 
                                                    fontSize: '12px', 
                                                    fontWeight: '600', 
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                √âtendre au {new Date(prochainPalier.dateCible).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}
                                            </button>
                                        </div>
                                    </div>
                                )}
                                
                                {config.afficherRemises && prochainPalier && prochainPalier.type === 'finMois' && (
                                    <div style={{ background: '#f0fdf4', border: '1px solid #86efac', borderRadius: '10px', padding: '16px', marginBottom: '20px' }}>
                                        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap', gap: '12px' }}>
                                            <div style={{ fontSize: '13px', color: '#166534' }}>
                                                üìÖ Aller jusqu'√† fin {prochainPalier.moisLabel} ?
                                            </div>
                                            <button 
                                                onClick={() => handleEtendreFinMois(prochainPalier.dateFinMois)}
                                                style={{ 
                                                    padding: '8px 14px', 
                                                    borderRadius: '6px', 
                                                    border: '1px solid #22c55e', 
                                                    background: 'white', 
                                                    color: '#166534', 
                                                    fontSize: '12px', 
                                                    fontWeight: '500', 
                                                    cursor: 'pointer'
                                                }}
                                            >
                                                Fin {prochainPalier.moisLabel}
                                            </button>
                                        </div>
                                    </div>
                                )}
                            </>
                        )}
                        
                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', fontSize: '14px', fontWeight: '600', color: '#374151', marginBottom: '8px' }}>Commentaire (optionnel)</label>
                            <textarea value={commentaire} onChange={(e) => setCommentaire(e.target.value)} placeholder="Contexte de la mission, environnement technique..." style={{ width: '100%', padding: '12px 14px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', minHeight: '80px', resize: 'vertical', fontFamily: 'inherit' }} />
                        </div>
                        
                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button onClick={onClose} style={{ flex: 1, padding: '14px', borderRadius: '10px', border: '1px solid #e2e8f0', background: 'white', fontSize: '15px', cursor: 'pointer', color: '#64748b' }}>Annuler</button>
                            <button 
                                onClick={() => datesValides && onSubmit({ consultant, dateDebut, dateFin, commentaire, tjmApplique, joursFacturables: facturables, montantTotal })} 
                                disabled={!datesValides}
                                style={{ 
                                    flex: 2, 
                                    padding: '14px', 
                                    borderRadius: '10px', 
                                    border: 'none', 
                                    background: datesValides ? 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)' : '#e2e8f0', 
                                    color: datesValides ? 'white' : '#94a3b8', 
                                    fontSize: '15px', 
                                    fontWeight: '600', 
                                    cursor: datesValides ? 'pointer' : 'not-allowed' 
                                }}
                            >
                                {datesValides ? 'Envoyer ma demande ‚Üí' : 'S√©lectionnez des dates valides'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        const ModalConfirmation = ({ onClose }) => (
            <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }} onClick={onClose}>
                <div style={{ background: 'white', borderRadius: '20px', padding: '40px', maxWidth: '420px', width: '90%', textAlign: 'center' }} onClick={e => e.stopPropagation()}>
                    <div style={{ width: '72px', height: '72px', background: '#dcfce7', borderRadius: '50%', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 24px', fontSize: '36px' }}>‚úì</div>
                    <h2 style={{ fontSize: '22px', color: '#1a365d', marginBottom: '12px' }}>Demande envoy√©e !</h2>
                    <p style={{ color: '#64748b', marginBottom: '24px', lineHeight: '1.6' }}>Nous avons bien re√ßu votre int√©r√™t. Souhaitez-vous planifier un √©change pour en discuter ?</p>
                    <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
                        <a 
                            href="https://cal.com/centum/rdv-profil" 
                            target="_blank" 
                            rel="noopener noreferrer"
                            style={{ 
                                display: 'flex', 
                                alignItems: 'center', 
                                justifyContent: 'center',
                                gap: '10px',
                                padding: '14px 24px', 
                                borderRadius: '10px', 
                                border: 'none', 
                                background: 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)', 
                                color: 'white', 
                                fontSize: '15px', 
                                fontWeight: '600', 
                                cursor: 'pointer',
                                textDecoration: 'none'
                            }}
                        >
                            üìÖ Planifier un RDV
                        </a>
                        <button onClick={onClose} style={{ padding: '12px 24px', borderRadius: '10px', border: '1px solid #e2e8f0', background: 'white', color: '#64748b', fontSize: '14px', cursor: 'pointer' }}>Plus tard</button>
                    </div>
                </div>
            </div>
        );
        
        const RequestCard = ({ onRequest, hasResults, filters }) => {
            const hasActiveFilters = filters.secteur || filters.competence || filters.seniorite;
            return (
                <div style={{ background: hasResults ? 'linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%)' : 'white', borderRadius: '16px', padding: '28px', boxShadow: '0 2px 12px rgba(0,0,0,0.08)', display: 'flex', flexDirection: 'column', gap: '16px', border: '2px dashed #cbd5e1', minHeight: hasResults ? 'auto' : '300px', justifyContent: 'center', alignItems: hasResults ? 'flex-start' : 'center', textAlign: hasResults ? 'left' : 'center' }}>
                    <div style={{ fontSize: '36px' }}>{hasResults ? 'üí¨' : 'üîç'}</div>
                    <div>
                        <div style={{ fontSize: '18px', fontWeight: '600', color: '#1a365d', marginBottom: '8px' }}>{hasResults ? 'Besoin d\'un autre profil ?' : 'Aucun profil ne correspond'}</div>
                        <div style={{ fontSize: '14px', color: '#64748b', lineHeight: '1.5' }}>{hasResults ? 'D√©crivez-nous votre besoin, nous reviendrons vers vous avec des profils adapt√©s.' : hasActiveFilters ? 'Vos crit√®res sont tr√®s sp√©cifiques. Faites-nous une demande personnalis√©e !' : 'D√©crivez votre besoin id√©al et nous chercherons pour vous.'}</div>
                    </div>
                    {hasActiveFilters && !hasResults && (
                        <div style={{ display: 'flex', gap: '8px', flexWrap: 'wrap' }}>
                            {filters.secteur && <span style={{ background: '#e0f2fe', color: '#0369a1', padding: '4px 10px', borderRadius: '4px', fontSize: '12px' }}>{secteurIcons[filters.secteur]} {filters.secteur}</span>}
                            {filters.competence && <span style={{ background: '#ede9fe', color: '#6d28d9', padding: '4px 10px', borderRadius: '4px', fontSize: '12px' }}>{filters.competence}</span>}
                            {filters.seniorite && <span style={{ background: '#fef3c7', color: '#92400e', padding: '4px 10px', borderRadius: '4px', fontSize: '12px' }}>{filters.seniorite}</span>}
                        </div>
                    )}
                    <button onClick={onRequest} style={{ background: hasResults ? 'white' : 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)', color: hasResults ? '#1a365d' : 'white', border: hasResults ? '2px solid #1a365d' : 'none', padding: '12px 24px', borderRadius: '10px', fontSize: '14px', fontWeight: '600', cursor: 'pointer', marginTop: '8px' }}>Faire une demande personnalis√©e ‚Üí</button>
                </div>
            );
        };
        
        // Modal de demande personnalis√©e
        const ModalDemandePersonnalisee = ({ onClose, onSubmit, filters }) => {
            const [besoin, setBesoin] = useState('');
            const [competences, setCompetences] = useState(filters.competence || '');
            const [secteur, setSecteur] = useState(filters.secteur || '');
            const [seniorite, setSeniorite] = useState(filters.seniorite || '');
            const [dateDebut, setDateDebut] = useState('');
            const [duree, setDuree] = useState('');
            const [contact, setContact] = useState('');
            
            return (
                <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.5)', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000 }} onClick={onClose}>
                    <div style={{ background: 'white', borderRadius: '20px', padding: '32px', maxWidth: '520px', width: '90%', maxHeight: '90vh', overflow: 'auto' }} onClick={e => e.stopPropagation()}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '24px' }}>
                            <div>
                                <h2 style={{ fontSize: '22px', color: '#1a365d', marginBottom: '8px' }}>Demande personnalis√©e</h2>
                                <p style={{ fontSize: '14px', color: '#64748b' }}>D√©crivez votre besoin, nous reviendrons vers vous avec des profils adapt√©s.</p>
                            </div>
                            <button onClick={onClose} style={{ background: 'none', border: 'none', fontSize: '24px', cursor: 'pointer', color: '#94a3b8' }}>√ó</button>
                        </div>
                        
                        <div style={{ marginBottom: '20px' }}>
                            <label style={{ display: 'block', fontSize: '14px', fontWeight: '600', color: '#374151', marginBottom: '8px' }}>D√©crivez votre besoin *</label>
                            <textarea 
                                value={besoin} 
                                onChange={(e) => setBesoin(e.target.value)} 
                                placeholder="Ex: Nous recherchons un architecte √©lectronique pour un projet de certification DO-254 dans le domaine a√©ronautique..."
                                style={{ width: '100%', padding: '12px 14px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', minHeight: '100px', resize: 'vertical', fontFamily: 'inherit' }} 
                            />
                        </div>
                        
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '16px', marginBottom: '20px' }}>
                            <div>
                                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#374151', marginBottom: '6px' }}>Comp√©tences souhait√©es</label>
                                <input 
                                    type="text" 
                                    value={competences} 
                                    onChange={(e) => setCompetences(e.target.value)} 
                                    placeholder="Ex: VHDL, Safety, MBSE..."
                                    style={{ width: '100%', padding: '10px 12px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px' }} 
                                />
                            </div>
                            <div>
                                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#374151', marginBottom: '6px' }}>Secteur</label>
                                <select value={secteur} onChange={(e) => setSecteur(e.target.value)} style={{ width: '100%', padding: '10px 12px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', background: 'white' }}>
                                    <option value="">Tous secteurs</option>
                                    <option value="A√©ronautique">‚úàÔ∏è A√©ronautique</option>
                                    <option value="Automobile">üöó Automobile</option>
                                    <option value="D√©fense">üõ°Ô∏è D√©fense</option>
                                    <option value="A√©rospatial">üöÄ A√©rospatial</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr 1fr', gap: '16px', marginBottom: '20px' }}>
                            <div>
                                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#374151', marginBottom: '6px' }}>S√©niorit√©</label>
                                <select value={seniorite} onChange={(e) => setSeniorite(e.target.value)} style={{ width: '100%', padding: '10px 12px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', background: 'white' }}>
                                    <option value="">Indiff√©rent</option>
                                    <option value="Junior">Junior</option>
                                    <option value="Confirm√©">Confirm√©</option>
                                    <option value="Senior">Senior</option>
                                </select>
                            </div>
                            <div>
                                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#374151', marginBottom: '6px' }}>Date de d√©marrage</label>
                                <input 
                                    type="date" 
                                    value={dateDebut} 
                                    onChange={(e) => setDateDebut(e.target.value)} 
                                    style={{ width: '100%', padding: '10px 12px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px' }} 
                                />
                            </div>
                            <div>
                                <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#374151', marginBottom: '6px' }}>Dur√©e estim√©e</label>
                                <select value={duree} onChange={(e) => setDuree(e.target.value)} style={{ width: '100%', padding: '10px 12px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px', background: 'white' }}>
                                    <option value="">√Ä d√©finir</option>
                                    <option value="< 3 mois">Moins de 3 mois</option>
                                    <option value="3-6 mois">3 √† 6 mois</option>
                                    <option value="> 6 mois">Plus de 6 mois</option>
                                </select>
                            </div>
                        </div>
                        
                        <div style={{ marginBottom: '24px' }}>
                            <label style={{ display: 'block', fontSize: '13px', fontWeight: '500', color: '#374151', marginBottom: '6px' }}>Email de contact *</label>
                            <input 
                                type="email" 
                                value={contact} 
                                onChange={(e) => setContact(e.target.value)} 
                                placeholder="votre.email@entreprise.com"
                                style={{ width: '100%', padding: '10px 12px', borderRadius: '8px', border: '1px solid #e2e8f0', fontSize: '14px' }} 
                            />
                        </div>
                        
                        <div style={{ display: 'flex', gap: '12px' }}>
                            <button onClick={onClose} style={{ flex: 1, padding: '14px', borderRadius: '10px', border: '1px solid #e2e8f0', background: 'white', fontSize: '15px', cursor: 'pointer', color: '#64748b' }}>Annuler</button>
                            <button 
                                onClick={() => {
                                    console.log('Demande personnalis√©e:', { besoin, competences, secteur, seniorite, dateDebut, duree, contact });
                                    onSubmit({ besoin, competences, secteur, seniorite, dateDebut, duree, contact });
                                }}
                                disabled={!besoin || !contact}
                                style={{ 
                                    flex: 2, 
                                    padding: '14px', 
                                    borderRadius: '10px', 
                                    border: 'none', 
                                    background: (besoin && contact) ? 'linear-gradient(135deg, #2563eb 0%, #1d4ed8 100%)' : '#e2e8f0', 
                                    color: (besoin && contact) ? 'white' : '#94a3b8', 
                                    fontSize: '15px', 
                                    fontWeight: '600', 
                                    cursor: (besoin && contact) ? 'pointer' : 'not-allowed' 
                                }}
                            >
                                Envoyer ma demande ‚Üí
                            </button>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Panneau de configuration Admin
        const AdminConfigPanel = ({ config, setConfig, profilsConfig, setProfilsConfig, isOpen, setIsOpen }) => {
            if (!isOpen) return null;
            
            return (
                <div style={{ 
                    position: 'fixed', 
                    top: 0, 
                    right: 0, 
                    width: '380px', 
                    height: '100vh', 
                    background: 'white', 
                    boxShadow: '-4px 0 24px rgba(0,0,0,0.15)', 
                    zIndex: 1001,
                    overflow: 'auto'
                }}>
                    <div style={{ padding: '24px', borderBottom: '1px solid #e2e8f0', display: 'flex', justifyContent: 'space-between', alignItems: 'center', background: '#1a365d', color: 'white' }}>
                        <div>
                            <div style={{ fontSize: '18px', fontWeight: '600' }}>‚öôÔ∏è Configuration vue client</div>
                            <div style={{ fontSize: '12px', opacity: 0.8, marginTop: '4px' }}>D√©finissez ce que vos clients peuvent voir</div>
                        </div>
                        <button onClick={() => setIsOpen(false)} style={{ background: 'none', border: 'none', color: 'white', fontSize: '24px', cursor: 'pointer' }}>√ó</button>
                    </div>
                    
                    <div style={{ padding: '24px' }}>
                        <div style={{ marginBottom: '28px' }}>
                            <div style={{ fontSize: '14px', fontWeight: '600', color: '#1a365d', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <span>üí∞</span> Informations tarifaires
                            </div>
                            
                            <label style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: '12px', background: '#f8fafc', borderRadius: '8px', marginBottom: '8px', cursor: 'pointer' }}>
                                <input type="checkbox" checked={config.afficherTJM} onChange={(e) => setConfig({...config, afficherTJM: e.target.checked})} style={{ width: '18px', height: '18px', accentColor: '#2563eb' }} />
                                <div>
                                    <div style={{ fontSize: '14px', fontWeight: '500', color: '#374151' }}>Afficher TJM</div>
                                    <div style={{ fontSize: '11px', color: '#64748b' }}>Tarif journalier dans la liste</div>
                                </div>
                            </label>
                            
                            <label style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: '12px', background: '#f8fafc', borderRadius: '8px', marginBottom: '8px', cursor: 'pointer' }}>
                                <input type="checkbox" checked={config.afficherRemises} onChange={(e) => setConfig({...config, afficherRemises: e.target.checked})} style={{ width: '18px', height: '18px', accentColor: '#2563eb' }} />
                                <div>
                                    <div style={{ fontSize: '14px', fontWeight: '500', color: '#374151' }}>Afficher remises</div>
                                    <div style={{ fontSize: '11px', color: '#64748b' }}>Paliers de r√©duction visibles</div>
                                </div>
                            </label>
                            
                            <label style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: '12px', background: '#f8fafc', borderRadius: '8px', marginBottom: '8px', cursor: 'pointer' }}>
                                <input type="checkbox" checked={config.afficherBudget} onChange={(e) => setConfig({...config, afficherBudget: e.target.checked})} style={{ width: '18px', height: '18px', accentColor: '#2563eb' }} />
                                <div>
                                    <div style={{ fontSize: '14px', fontWeight: '500', color: '#374151' }}>Afficher budget indicatif</div>
                                    <div style={{ fontSize: '11px', color: '#64748b' }}>Calcul du montant total</div>
                                </div>
                            </label>
                            
                            <label style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: '12px', background: '#f8fafc', borderRadius: '8px', marginBottom: '8px', cursor: 'pointer' }}>
                                <input type="checkbox" checked={config.afficherGrilleTarifaire} onChange={(e) => setConfig({...config, afficherGrilleTarifaire: e.target.checked})} style={{ width: '18px', height: '18px', accentColor: '#2563eb' }} />
                                <div>
                                    <div style={{ fontSize: '14px', fontWeight: '500', color: '#374151' }}>Afficher grille tarifaire</div>
                                    <div style={{ fontSize: '11px', color: '#64748b' }}>Tableau des tarifs dans les fiches</div>
                                </div>
                            </label>
                            
                            <label style={{ display: 'flex', alignItems: 'center', gap: '12px', padding: '12px', background: '#f8fafc', borderRadius: '8px', cursor: 'pointer' }}>
                                <input type="checkbox" checked={config.afficherTauxOccupation} onChange={(e) => setConfig({...config, afficherTauxOccupation: e.target.checked})} style={{ width: '18px', height: '18px', accentColor: '#2563eb' }} />
                                <div>
                                    <div style={{ fontSize: '14px', fontWeight: '500', color: '#374151' }}>Afficher taux d'occupation</div>
                                    <div style={{ fontSize: '11px', color: '#64748b' }}>% de dispo sur la p√©riode</div>
                                </div>
                            </label>
                        </div>
                        
                        <div style={{ marginBottom: '28px' }}>
                            <div style={{ fontSize: '14px', fontWeight: '600', color: '#1a365d', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <span>üëÅÔ∏è</span> Profils & Badges FOMO
                            </div>
                            <div style={{ fontSize: '11px', color: '#64748b', marginBottom: '12px' }}>
                                S√©lectionnez les profils visibles et ajoutez des badges pour cr√©er de l'urgence.
                            </div>
                            
                            <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', maxHeight: '320px', overflow: 'auto', padding: '4px' }}>
                                {consultantsData.map(c => {
                                    const pc = profilsConfig[c.id] || { visible: true, fomo: 'aucun' };
                                    const prochaineIndispo = c.periodes.find(p => p.type === 'indispo' && new Date(p.debut) > new Date('2026-02-04'));
                                    
                                    return (
                                        <div key={c.id} style={{ 
                                            background: pc.visible ? '#f0f9ff' : '#f8fafc', 
                                            border: pc.visible ? '1px solid #3b82f6' : '1px solid #e2e8f0',
                                            borderRadius: '8px', 
                                            padding: '12px',
                                            opacity: pc.visible ? 1 : 0.6
                                        }}>
                                            <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '8px' }}>
                                                <input 
                                                    type="checkbox" 
                                                    checked={pc.visible} 
                                                    onChange={(e) => {
                                                        setProfilsConfig({
                                                            ...profilsConfig, 
                                                            [c.id]: { ...pc, visible: e.target.checked }
                                                        });
                                                    }} 
                                                    style={{ width: '18px', height: '18px', accentColor: '#2563eb' }} 
                                                />
                                                <div style={{ flex: 1 }}>
                                                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>
                                                        <span style={{ fontWeight: '700', color: '#1a365d', fontSize: '14px' }}>{c.code}</span>
                                                        <span style={{ fontSize: '11px', color: '#64748b' }}>{c.seniorite}</span>
                                                    </div>
                                                    <div style={{ fontSize: '10px', color: '#94a3b8' }}>{c.competences[0]}</div>
                                                </div>
                                                {prochaineIndispo && (
                                                    <div style={{ fontSize: '10px', color: '#f59e0b', background: '#fef3c7', padding: '2px 6px', borderRadius: '4px' }}>
                                                        Indispo {new Date(prochaineIndispo.debut).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' })}
                                                    </div>
                                                )}
                                            </div>
                                            
                                            {pc.visible && (
                                                <div style={{ marginLeft: '30px' }}>
                                                    <select 
                                                        value={pc.fomo} 
                                                        onChange={(e) => {
                                                            setProfilsConfig({
                                                                ...profilsConfig, 
                                                                [c.id]: { ...pc, fomo: e.target.value }
                                                            });
                                                        }}
                                                        style={{ 
                                                            width: '100%', 
                                                            padding: '6px 10px', 
                                                            borderRadius: '6px', 
                                                            border: '1px solid #e2e8f0', 
                                                            fontSize: '12px', 
                                                            background: 'white',
                                                            color: pc.fomo !== 'aucun' ? fomoOptions.find(f => f.value === pc.fomo)?.color : '#374151'
                                                        }}
                                                    >
                                                        {fomoOptions.map(opt => (
                                                            <option key={opt.value} value={opt.value}>{opt.label}</option>
                                                        ))}
                                                    </select>
                                                </div>
                                            )}
                                        </div>
                                    );
                                })}
                            </div>
                            
                            <div style={{ fontSize: '11px', color: '#64748b', marginTop: '12px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                                <span>{Object.values(profilsConfig).filter(p => p.visible).length} profil(s) visible(s)</span>
                                <div style={{ display: 'flex', gap: '8px' }}>
                                    <button 
                                        onClick={() => {
                                            const newConfig = {...profilsConfig};
                                            Object.keys(newConfig).forEach(id => newConfig[id] = {...newConfig[id], visible: true});
                                            setProfilsConfig(newConfig);
                                        }} 
                                        style={{ background: 'none', border: 'none', color: '#2563eb', fontSize: '11px', cursor: 'pointer', textDecoration: 'underline' }}
                                    >
                                        Tout afficher
                                    </button>
                                    <button 
                                        onClick={() => {
                                            const newConfig = {...profilsConfig};
                                            Object.keys(newConfig).forEach(id => newConfig[id] = {...newConfig[id], visible: false});
                                            setProfilsConfig(newConfig);
                                        }} 
                                        style={{ background: 'none', border: 'none', color: '#dc2626', fontSize: '11px', cursor: 'pointer', textDecoration: 'underline' }}
                                    >
                                        Tout masquer
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <div style={{ marginBottom: '28px' }}>
                            <div style={{ fontSize: '14px', fontWeight: '600', color: '#1a365d', marginBottom: '16px', display: 'flex', alignItems: 'center', gap: '8px' }}>
                                <span>üìÖ</span> P√©riode visible
                            </div>
                            
                            <div style={{ padding: '12px', background: '#f8fafc', borderRadius: '8px' }}>
                                <div style={{ display: 'flex', gap: '8px', alignItems: 'center' }}>
                                    <input type="range" min="1" max="11" value={config.moisVisibles} onChange={(e) => setConfig({...config, moisVisibles: parseInt(e.target.value)})} style={{ flex: 1 }} />
                                    <span style={{ minWidth: '60px', textAlign: 'center', fontWeight: '600', color: '#2563eb' }}>{config.moisVisibles} mois</span>
                                </div>
                                <div style={{ fontSize: '11px', color: '#64748b', marginTop: '4px' }}>F√©v ‚Üí {['F√©v', 'Mars', 'Avr', 'Mai', 'Juin', 'Juil', 'Ao√ªt', 'Sept', 'Oct', 'Nov', 'D√©c'][config.moisVisibles - 1]} 2026</div>
                            </div>
                        </div>
                        
                        <div style={{ background: '#f0fdf4', border: '1px solid #bbf7d0', borderRadius: '8px', padding: '16px' }}>
                            <div style={{ fontSize: '13px', color: '#166534', fontWeight: '600', marginBottom: '8px' }}>üí° Conseil</div>
                            <div style={{ fontSize: '12px', color: '#166534', lineHeight: '1.5' }}>
                                Pour maximiser l'effet FOMO, masquez les TJM et remises, s√©lectionnez 3-5 profils, ajoutez des badges "Forte demande" ou "D√©j√† propos√© ailleurs", et r√©duisez la p√©riode √† 3 mois.
                            </div>
                        </div>
                    </div>
                </div>
            );
        };
        
        // Toggle Admin/Client
        const ModeToggle = ({ mode, setMode, onConfigClick }) => (
            <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                <div style={{ display: 'flex', background: '#1a365d', borderRadius: '10px', padding: '4px' }}>
                    <button 
                        onClick={() => setMode('admin')} 
                        style={{ 
                            padding: '8px 16px', 
                            borderRadius: '8px', 
                            border: 'none', 
                            background: mode === 'admin' ? 'white' : 'transparent', 
                            color: mode === 'admin' ? '#1a365d' : 'rgba(255,255,255,0.7)', 
                            fontWeight: mode === 'admin' ? '600' : '400', 
                            cursor: 'pointer', 
                            fontSize: '13px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px'
                        }}
                    >
                        üîß Admin
                    </button>
                    <button 
                        onClick={() => setMode('client')} 
                        style={{ 
                            padding: '8px 16px', 
                            borderRadius: '8px', 
                            border: 'none', 
                            background: mode === 'client' ? 'white' : 'transparent', 
                            color: mode === 'client' ? '#1a365d' : 'rgba(255,255,255,0.7)', 
                            fontWeight: mode === 'client' ? '600' : '400', 
                            cursor: 'pointer', 
                            fontSize: '13px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px'
                        }}
                    >
                        üë§ Vue client
                    </button>
                </div>
                {mode === 'admin' && (
                    <button 
                        onClick={onConfigClick}
                        style={{ 
                            padding: '8px 16px', 
                            borderRadius: '8px', 
                            border: '2px solid #e2e8f0', 
                            background: 'white', 
                            color: '#374151', 
                            fontWeight: '500', 
                            cursor: 'pointer', 
                            fontSize: '13px',
                            display: 'flex',
                            alignItems: 'center',
                            gap: '6px'
                        }}
                    >
                        ‚öôÔ∏è Configurer vue client
                    </button>
                )}
            </div>
        );
        
        // Badge FOMO
        const FomoBadge = ({ text, color }) => (
            <div style={{
                position: 'absolute',
                top: '-8px',
                right: '-8px',
                background: color,
                color: 'white',
                padding: '4px 10px',
                borderRadius: '12px',
                fontSize: '10px',
                fontWeight: '700',
                textTransform: 'uppercase',
                boxShadow: '0 2px 8px rgba(0,0,0,0.2)',
                zIndex: 10,
                whiteSpace: 'nowrap'
            }}>
                üî• {text}
            </div>
        );
        
        const App = () => {
            const [filters, setFilters] = useState({ competence: '', seniorite: '', secteur: '' });
            const [selectedReservation, setSelectedReservation] = useState(null);
            const [showConfirmation, setShowConfirmation] = useState(false);
            const [view, setView] = useState('timeline');
            const [showRequestModal, setShowRequestModal] = useState(false);
            
            // Nouveau : mode et config
            const [mode, setMode] = useState('admin'); // 'admin' ou 'client'
            const [showConfig, setShowConfig] = useState(false);
            const [visibilityConfig, setVisibilityConfig] = useState(defaultVisibilityConfig);
            const [profilsConfig, setProfilsConfig] = useState(defaultProfilsConfig);
            
            // Appliquer la config selon le mode
            const config = mode === 'admin' ? defaultVisibilityConfig : visibilityConfig;
            
            // Helper pour obtenir le FOMO d'un consultant
            const getFomoForConsultant = (consultantId) => {
                const pc = profilsConfig[consultantId];
                if (!pc || pc.fomo === 'aucun') return null;
                const fomoOption = fomoOptions.find(f => f.value === pc.fomo);
                if (!fomoOption || !fomoOption.color) return null;
                
                let label = fomoOption.label;
                // Pour "mission √† venir", ajouter la date
                if (pc.fomo === 'mission-a-venir' && pc.prochaineIndispo) {
                    const dateIndispo = new Date(pc.prochaineIndispo).toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
                    label = `üìÖ Part le ${dateIndispo}`;
                }
                return { badge: label, color: fomoOption.color };
            };
            
            const filteredConsultants = consultantsData.filter(c => {
                // Filtre par profils visibles en mode client
                if (mode === 'client' && !profilsConfig[c.id]?.visible) return false;
                if (filters.competence && !c.competences.includes(filters.competence)) return false;
                if (filters.seniorite && c.seniorite !== filters.seniorite) return false;
                if (filters.secteur && !c.secteurs.includes(filters.secteur)) return false;
                return true;
            });
            
            // Compter les profils visibles
            const profilsVisiblesCount = Object.values(profilsConfig).filter(p => p.visible).length;
            
            const handleReserver = (consultant, periode) => {
                setSelectedReservation({ consultant, periode });
            };
            
            const handleSubmitReservation = (data) => {
                console.log('R√©servation envoy√©e:', data);
                setSelectedReservation(null);
                setShowConfirmation(true);
            };
            
            return (
                <div style={{ minHeight: '100vh', background: '#f5f7fa' }}>
                    {/* Header avec mode toggle */}
                    <header style={{ background: 'white', borderBottom: '1px solid #e2e8f0', padding: '16px 32px', display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>
                        <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>
                            <div style={{ width: '48px', height: '48px', background: 'linear-gradient(135deg, #1a365d 0%, #2d4a7c 100%)', borderRadius: '12px', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>
                                <span style={{ color: 'white', fontWeight: 'bold', fontSize: '20px' }}>C</span>
                            </div>
                            <div>
                                <div style={{ fontWeight: 'bold', fontSize: '18px', color: '#1a365d' }}>Centum T&S</div>
                                <div style={{ fontSize: '12px', color: '#64748b' }}>
                                    {mode === 'admin' ? 'Mode administrateur' : 'Aper√ßu client ‚Ä¢ Airbus Defence & Space'}
                                </div>
                            </div>
                        </div>
                        <ModeToggle mode={mode} setMode={setMode} onConfigClick={() => setShowConfig(true)} />
                    </header>
                    
                    {/* Bandeau mode client */}
                    {mode === 'client' && (
                        <div style={{ background: '#fef3c7', borderBottom: '1px solid #fbbf24', padding: '12px 32px', display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '12px' }}>
                            <span style={{ fontSize: '16px' }}>üëÅÔ∏è</span>
                            <span style={{ fontSize: '14px', color: '#92400e', fontWeight: '500' }}>
                                Vous visualisez ce que verra votre client avec la configuration actuelle
                            </span>
                        </div>
                    )}
                    
                    <main style={{ padding: '32px', maxWidth: '1800px', margin: '0 auto' }}>
                        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', marginBottom: '24px' }}>
                            <div>
                                <h1 style={{ fontSize: '28px', color: '#1a365d', marginBottom: '8px' }}>Plan de charge partag√©</h1>
                                <p style={{ color: '#64748b' }}>
                                    {mode === 'admin' 
                                        ? 'Vue compl√®te avec toutes les informations. Configurez ce que vos clients peuvent voir.'
                                        : 'Visualisez les disponibilit√©s et r√©servez directement les cr√©neaux qui vous int√©ressent.'
                                    }
                                </p>
                            </div>
                            <ViewToggle view={view} setView={setView} />
                        </div>
                        <Filtres filters={filters} setFilters={setFilters} consultantCount={filteredConsultants.length} totalCount={mode === 'client' ? profilsVisiblesCount : consultantsData.length} />
                        
                        {view === 'timeline' ? (
                            <>
                                <TimelineBooking 
                                    consultants={filteredConsultants} 
                                    onReserver={handleReserver} 
                                    config={config}
                                    mode={mode}
                                    getFomoForConsultant={getFomoForConsultant}
                                />
                                <div style={{ marginTop: '20px' }}>
                                    <RequestCard onRequest={() => setShowRequestModal(true)} hasResults={filteredConsultants.length > 0} filters={filters} />
                                </div>
                            </>
                        ) : (
                            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(340px, 1fr))', gap: '20px' }}>
                                {filteredConsultants.map(c => (
                                    <ConsultantCard 
                                        key={c.id} 
                                        consultant={c} 
                                        onInteret={handleReserver}
                                        config={config}
                                        mode={mode}
                                        fomo={mode === 'client' ? getFomoForConsultant(c.id) : null}
                                    />
                                ))}
                                <RequestCard onRequest={() => setShowRequestModal(true)} hasResults={filteredConsultants.length > 0} filters={filters} />
                            </div>
                        )}
                    </main>
                    <footer style={{ textAlign: 'center', padding: '24px', color: '#94a3b8', fontSize: '13px', borderTop: '1px solid #e2e8f0', marginTop: '40px' }}>Portail Partenaires Centum T&S ‚Ä¢ Propuls√© par SalesAiFlo</footer>
                    
                    {selectedReservation && (
                        <ModalReservation 
                            consultant={selectedReservation.consultant} 
                            periode={selectedReservation.periode} 
                            onClose={() => setSelectedReservation(null)} 
                            onSubmit={handleSubmitReservation}
                            config={config}
                            mode={mode}
                        />
                    )}
                    {showConfirmation && <ModalConfirmation onClose={() => setShowConfirmation(false)} />}
                    {showRequestModal && (
                        <ModalDemandePersonnalisee 
                            onClose={() => setShowRequestModal(false)} 
                            onSubmit={(data) => {
                                console.log('Demande personnalis√©e envoy√©e:', data);
                                setShowRequestModal(false);
                                setShowConfirmation(true);
                            }}
                            filters={filters}
                        />
                    )}
                    
                    {/* Panneau config admin */}
                    <AdminConfigPanel 
                        config={visibilityConfig} 
                        setConfig={setVisibilityConfig}
                        profilsConfig={profilsConfig}
                        setProfilsConfig={setProfilsConfig}
                        isOpen={showConfig} 
                        setIsOpen={setShowConfig} 
                    />
                    {showConfig && <div style={{ position: 'fixed', top: 0, left: 0, right: 0, bottom: 0, background: 'rgba(0,0,0,0.3)', zIndex: 1000 }} onClick={() => setShowConfig(false)} />}
                </div>
            );
        };
        
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
